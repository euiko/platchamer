/*
 * Make makefile for graffit library < Imakefile >
 *
 * Target libgraffit.a and .so for Borland Graphics Interface
 *
 * Copyright (C) 1992-1994,1995 Taiji Yamada, Tokyo Denki University
 * Copyright (C) 1995-1999 Taiji Yamada, AIHARA Electrical Engineering Co.,Ltd.
 */
#include "../../config.h"

INSTALLFLAGS = -c $(INSTINCFLAGS)

#include "define.h"

INCLUDES = -I.
LINTLIBS = $(LINTXTOLL) $(LINTXLIB)
EXTRA_INCLUDES = -I../../sources/common -I../../sources/x11 -I../../sources/ps -I../../sources/misc
HEADERS = $(GRAFFIT_HEADERS)
SRCS = $(GRAFFIT_SRCS)
OBJS = $(GRAFFIT_OBJS)

#ifdef DarwinArchitecture
REQUIREDLIBS = -flat_namespace -undefined suppress
#endif
#ifdef RsArchitecture
REQUIREDLIBS = $(XTOOLLIB) $(XPMLIB) $(XLIB) -lm
#endif
#ifdef AlphaArchitecture
SO_REQLIBS = $(XTOOLLIB) $(XPMLIB) $(XLIB) -lm -lc
#endif

#ifndef DoSharedLib
#define DoSharedLib (HasSharedLibraries && \
		     !(defined(SGIArchitecture) && !SystemV4))
#endif
#ifndef DoNormalLib
#define DoNormalLib YES
#endif

#if (ProjectX < 5)
  STD_DEFINES = LibraryDefines
  CDEBUGFLAGS = LibraryCDebugFlags
#else
#define LibName graffit
#define SoRev XBGILIBREV
#define SHLIBDIR XBGILIBDIR
#define USRLIBDIR XBGILIBDIR
#ifdef InstallHome
#define INCDIR LOCALINC
#endif
#include <Library.tmpl>
XCOMM CC=gcc
XCOMM PICFLAGS=-fpic
#endif

XCOMM #if defined(BuildStandaloneLibs)
XCOMM STD_DEFINES += -DBUILD_STANDALONE
XCOMM #endif

#if (ProjectX < 6)

#if (ProjectX < 5)

#if DoSharedLib
SharedLibraryObjectRule()
NormalSharedLibraryTarget(graffit,$(XBGILIBREV),$(OBJS))
InstallSharedLibrary(graffit,$(XBGILIBREV),$(XBGILIBDIR))
#else
NormalLibraryObjectRule()
#endif
NormalLibraryTarget(graffit,$(OBJS))
InstallLibrary(graffit,$(XBGILIBDIR))

#else /* (ProjectX >= 5) */

LibraryObjectRule()

#if DoSharedLib
SharedLibraryTarget(graffit,$(XBGILIBREV),$(OBJS),shared,..)
InstallSharedLibrary(graffit,$(XBGILIBREV),$(XBGILIBDIR))
#endif
#if DoNormalLib
NormalLibraryTarget(graffit,$(OBJS))
InstallLibrary(graffit,$(XBGILIBDIR))
#endif

#endif /* (ProjectX < 5) */

InstallMultiple($(HEADERS),$(XBGIINCDIR))
BuildIncludes($(HEADERS),.,.)

#endif /* (ProjectX < 6) */

LintLibraryTarget(graffit,$(SRCS))
InstallLintLibrary(graffit,$(LINTLIBDIR))
DependTarget()
NormalLintTarget($(SRCS))
