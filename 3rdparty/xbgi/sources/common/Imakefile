/*
 * Make makefile for the common library < Imakefile >
 *
 * Target common/libxbgi_common.a and .so: Borland Graphics Interface for UNIX
 *
 * Copyright (C) 1992-1994,1995 Taiji Yamada, Tokyo Denki University
 * Copyright (C) 1995-1999 Taiji Yamada, AIHARA Electrical Engineering Co.,Ltd.
 */
#include "../../config.h"

INSTALLFLAGS = -c $(INSTINCFLAGS)

#include "define.h"

INCLUDES = -I.
LINTLIBS = $(LINTXTOLL) $(LINTXLIB)
EXTRA_INCLUDES = -I../misc
HEADERS = $(COMMON_HEADERS)
SRCS = $(COMMON_SRCS)
OBJS = $(COMMON_OBJS)

#ifdef DarwinArchitecture
REQUIREDLIBS = -flat_namespace -undefined suppress
#endif
#ifdef RsArchitecture
REQUIREDLIBS = $(XTOOLLIB) $(XPMLIB) $(XLIB) -lm
#endif
#ifdef AlphaArchitecture
SO_REQLIBS = $(XTOOLLIB) $(XPMLIB) $(XLIB) -lm -lc
#endif

#ifndef DoSharedLib
#define DoSharedLib (HasSharedLibraries && \
		     !(defined(SGIArchitecture) && !SystemV4))
#endif
#ifndef DoNormalLib
#define DoNormalLib YES
#endif

#if (ProjectX < 5)
  STD_DEFINES = LibraryDefines
  CDEBUGFLAGS = LibraryCDebugFlags
#else
#define LibName xbgi_common
#define SoRev XBGILIBREV
#define SHLIBDIR XBGILIBDIR
#define USRLIBDIR XBGILIBDIR
#ifdef InstallHome
#define INCDIR LOCALINC
#endif
#include <Library.tmpl>
XCOMM CC=gcc
XCOMM PICFLAGS=-fpic
#endif

#if defined(BuildStandaloneLibs)
STD_DEFINES += -DBUILD_STANDALONE
#endif

#if (ProjectX < 6)

#if (ProjectX < 5)

#if DoSharedLib
SharedLibraryObjectRule()
NormalSharedLibraryTarget(xbgi_common,$(XBGILIBREV),$(OBJS))
InstallSharedLibrary(xbgi_common,$(XBGILIBREV),$(XBGILIBDIR))
#else
NormalLibraryObjectRule()
#endif
NormalLibraryTarget(xbgi_common,$(OBJS))
InstallLibrary(xbgi_common,$(XBGILIBDIR))

#else /* (ProjectX < 5) */

LibraryObjectRule()

#if DoSharedLib
SharedLibraryTarget(xbgi_common,$(XBGILIBREV),$(OBJS),shared,..)
InstallSharedLibrary(xbgi_common,$(XBGILIBREV),$(XBGILIBDIR))
#endif
#if DoNormalLib
NormalLibraryTarget(xbgi_common,$(OBJS))
InstallLibrary(xbgi_common,$(XBGILIBDIR))
#endif

#endif /* (ProjectX < 5) */

InstallMultiple($(HEADERS),$(XBGIINCDIR))
BuildIncludes($(HEADERS),.,.)

#endif /* (ProjectX < 6) */

LintLibraryTarget(xbgi_common,$(SRCS))
InstallLintLibrary(xbgi_common,$(LINTLIBDIR))
DependTarget()
NormalLintTarget($(SRCS))
